---
tags: 
URL: 
著者: 
created: 2024-05-01 17:12
modified: 2024-05-12 16:54
---

# PDFから略語データを抜き出す

## 概要

[外来語略語の形成についての史的研究](先行研究/外来語略語の形成についての史的研究.md)という論文の付録に略語データが掲載されている。
PDF形式なので抜き出すのに一手間必要。

## 作戦

- PDF→HTMLに変換
    - [オンラインでPDFからHTMLに変換](https://www.idrsolutions.com/ja/online-pdf-to-html-converter)
- HTMLから法則性を見出してうまく略語を抽出

### HTML

- 略語リストの法則
    - `'・'`で始まる
    - 原語
        - `'・'`の次から始まる
        - `'：'`まで続く
        - 略語で省略された部分は小さく表示される
- HTMLの法則
    - 本文は`div.text-container`に入っている
    - `'・'`を含む要素は`elem.getClientRects().x === 130`である
    - 文字
        - 普通の大きさの文字は`span.s1_***`（`***`はページ数）
        - 小さい文字は`span.s2_***`

## 実装

- [Jupyterファイル](../外来語略語の形成についての史的研究-html/get_data.ipynb)
- [JSONファイル](../外来語略語の形成についての史的研究-html/abbreviation.json)

BeautifulSoupでHTMLを静的解析して目的のデータを抜き出すように実装した

出力はJSON形式で、

```python
class Abbreviation(BaseModel):
    """略語データ"""

    abbreviation: str  # 略語
    word: str  # 原語
```

↑のリスト形式で保存している

### データの特徴

```json
{
    "abbreviation": "パソ・コン",
    "word": "パーソナル・コンピュータ"
}
```

上記のように原語・略語ともに、複合語は「・」で分割されている

### 詰まったところ

#### クラス名

クラス名がファイルによって異なる
ファイルはPDFのページに対応して、`182.html`のように作られている
ページのコンテンツ順にクラス名が当てられるので、見出し要素があるかどうかなどでクラス名が別ファイルと対応が取れないようになっている

解決方法
`<style>`タグをみて普通サイズ、小さいサイズのクラスを特定する方法を取った

#### 略語部分の判定

略語部分の行は「・」で始まるが、複合語の分割記号も「・」であるため、うまく工夫しないと説明部分が略語として判定されることがある

工夫は、「。」が含まれる文章が略語部分として判定されたときは誤判定であるため軌道修正するということ。

### どうでもいいこと

Pydanticの`BaseModel`に`.model_dump()`というメソッドがあって、辞書型に簡単に変換できることを知った
